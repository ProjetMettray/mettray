<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>
			{% block title %}Welcome!
			{% endblock %}
		</title>
		{% block stylesheets %}
			<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fullcalendar/core@4.1.0/main.min.css">
			<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@4.1.0/main.min.css">
			<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@4.1.0/main.min.css">
			<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

		{% endblock %}
		<body>
			{% include "partials/_navbar.html.twig" %}
			{% block body %}{% endblock %}
		</body>
		{% block javascripts %}
			<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@4.1.0/main.min.js"></script>
			<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/interaction@4.1.0/main.min.js"></script>
			<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@4.1.0/main.min.js"></script>
			<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@4.1.0/main.min.js"></script>
			<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
			<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
			<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
			<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
			{% if data is defined %}
			<script type="text/javascript">
				document.addEventListener('DOMContentLoaded', () => {

						let evenement = '{{ data | raw }}'
						evenement = JSON.parse(evenement)

						let jsonEvent = [];
						evenement.forEach(element => {
							let jsonNewEvent = {
								id: element.id,
								title: element.title,
								'start': element.start.date,
								'end': element.end.date
							};
							jsonEvent.push(jsonNewEvent)
						});
						var calendarEl = document.getElementById('calendar-holder');

						var calendar = new FullCalendar.Calendar(calendarEl, {
							defaultView: 'dayGridMonth',
							editable: true,
							eventDrop: (datas) => {
								if(!confirm("Êtes vous sûr de vouloir modifier la date de cet évenement ?")){
									datas.revert()
								} else {
									let url = `/api/${datas.event.id}/edit`
									console.log(datas.event.end)
									let donnees = {
										"title": datas.event.title,
										"start": datas.event.start,
										"end": datas.event.end,
										"roomId": evenement[0].roomId
									}
									let xhr = new XMLHttpRequest
									xhr.open("PUT", url)
									xhr.send(JSON.stringify(donnees))
								}
							},
							eventClick: (datas) => {
								
							},
							eventSources: [
								{
									url: "{{ path('main') }}",
									method: "POST",
									extraParams: {
										filters: JSON.stringify({})
									},
									failure: () => { // alert("There was an error while fetching FullCalendar!");
									}
								},
							],
							header: {
								left: 'prev next today',
								center: 'title',
								right: 'dayGridMonth,timeGridWeek,timeGridDay'
							},
							buttonText: {
								today: 'Aujourd\'hui',
								day: 'Jour',
								month: 'Mois',
								week: 'Semaine'
							},
							plugins: [
								'interaction', 'dayGrid', 'timeGrid'
							], // https://fullcalendar.io/docs/plugin-index
							locale: 'fr',
							events: jsonEvent,
							timeZone: 'Europe/Paris'
						});


						calendar.render();
				});		
			</script>
			{% endif %}
		</head>
	{% endblock %}
</html>
