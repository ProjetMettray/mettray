{% extends 'base.html.twig' %}

{% block title %}
	Liste des utilisateurs par association | Mettray
{% endblock %}

{% block body %}

	<div class="container text-center my-5 pb-2 bg-white border border-ter rounded">
		<h1 class="p-5 text-ter">Liste des utilisateurs par structure/association</h1>
		{% for asso in associations %}
			<h1 class="text-ter">{{asso.name}}</h1>
			<p class="text-ter">Email:
				{{asso.email}}</p>
			<p class="text-ter">
				Téléphone:
				{{asso.telephone}}</p>
			<div>
				{% if is_granted('ROLE_ADMIN') %}
					<a type="button" class="btn fc-button-primary" href="{{path("association_update",{'association': asso.id})}}">Modifier</a>
					<a type="button" class="btn btn-danger" href="{{path("association_delete",{'association': asso.id})}}">Supprimer</a>
				{% endif %}
			</div>
			
			<hr class="bg-white" style="width:70%;">
			<ul class="p-2">
				<table class="table table-striped table-perso table-hover">
					<thead>
						<tr class="table-perso">
							<th scope="col">Nom</th>
							<th scope="col">Email</th>
							<th scope="col">Téléphone</th>
							{% if is_granted('ROLE_ADMIN') %}
								<th scope="col">Modifier</th>
								<th scope="col">Supprimer</th>
							{% endif %}
						</tr>
					</thead>
					{% for user in users %}
						{% for assoUser in user.associationUsers %}
							{% if assoUser.association.id == asso.id %}
								<tbody>
									<tr class="table-active ts">
										<td>{{ user.firstname }}
											{{ user.lastname }}</td>
										<td>{{ user.email }}</td>
										<td>{{ user.phone }}</td>
										{% if is_granted('ROLE_ADMIN') %}
											<td>
												<a href="{{path("user_edit",{'id': user.id})}}" type="button" class="btn fc-button-primary">Modifier</a>
											</td>
											<td>
												<a href="{{path("user_delete",{'id': user.id})}}" type="button" class="btn btn-danger">Supprimer</a>
											</td>
										{% endif %}
									</tr>
								</tbody>
							{% endif %}
						{% endfor %}
					{% endfor %}
				</table>
			</ul>
		{% endfor %}
	</div>
{% endblock %}
{% block footer %}
	<div class="bg-prim">
		<div class="container">
			<div>
				{% if is_granted('ROLE_ADMIN') %}
					<nav class="navbar navbar-expand-lg bg-prim rounded text-center d-flex justify-content-around fixed-bottom">
						<a class="btn btn-ter ml-3" href="{{ path('location_add') }}">Ajouter une adresse</a>
						<!-- Button trigger modal -->
						<button type="button" class="btn bg-sec border-sec text-ter mt-1 modal_button" data-toggle="modal" data-target={{ "#exampleModal" }} id={{ "modalButton" }} name="associationId" value={{ 1 }}>
							Ajouter un utilisateur par association
						</button>
						<a class="btn btn-ter ml-3" href="{{ path('association_add') }}">Ajouter une structure/association</a>
					</nav>

					<!-- Modal -->
					<div class="modal fade" id={{ "exampleModal" }} tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
						
						<div class="modal-dialog" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title" id="exampleModalLabel">Ajouter un utilisateur</h5>
									<button type="button" class="close" data-dismiss="modal" aria-label="Close">
									<span aria-hidden="true">&times;</span>
									</button>
								</div>
								<div class="modal-body">

									{{ form_start(usersModalForm) }}
										
									{{ form_end(usersModalForm) }}
									
								</div>
						</div>
					</div>

			</div>
				{% endif %}
			</div>
		</div>
	</div>
{% endblock %}
