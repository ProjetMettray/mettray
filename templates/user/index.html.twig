{% extends 'base.html.twig' %}

{% block title %}Utilisateur Mettray
{% endblock %}

{% block body %}

	<div class="container text-center mt-5 bg-dark">
		<h1 class="p-5 text-white">Liste des utilisateurs par association</h1>
			<div class="d-flex start-flex p-4 ">
			{% if app.user %}
				{% if (app.user.roles[0] is same as ("ROLE_ADMIN")) %}
					<a class="btn btn-light ml-3" href="{{ path('user_add') }}">Ajouter</a>
				{% endif %}
			{% endif %}
		</div>
		{% for asso in associations %}
			<h1 class="text-white">{{asso.name}}</h1>
			<p class="text-white">Email:
				{{asso.email}}</p>
			<p class="text-white">
				Téléphone:
				{{asso.telephone}}</p>
			<div>
			{% if is_granted('ROLE_ADMIN') %}
				<a type="button" class="btn btn-primary" href="{{path("association_update",{'association': asso.id})}}">Modifier</a>
				<a type="button" class="btn btn-danger" href="{{path("association_delete",{'association': asso.id})}}">Supprimer</a>
			{% endif %}
			</div>
			<hr class="bg-white" style="width:70%;">
			<ul class="p-2">
				<table class="table table-striped table-success table-hover">
					<thead>
						<tr class="table-success">
							<th scope="col">Nom</th>
							<th scope="col">Email</th>
							<th scope="col">téléphone</th>
						{% if is_granted('ROLE_ADMIN') %}
							<th scope="col">Ajouter association</th>
							<th scope="col">Mot de passe</th>
							<th scope="col">Modifier</th>
							<th scope="col">Supprimer</th>
						{% endif %}
						</tr>
					</thead>
					{% for user in users %}
						{% for assoUser in user.associationUsers %}
							{% if assoUser.association.id == asso.id %}
								<tbody>
									<tr class="table-active ts">
										<td>{{ user.firstname }}
											{{ user.lastname }}</td>
										<td>{{ user.email }}</td>
										<td>{{ user.phone }}</td>
									{% if is_granted('ROLE_ADMIN') %}
										<td>
											<a href="{{path("user_add_association",{'id': user.id})}}" type="button" class="btn btn-outline-success">+ association</a>
										</td>
										<td>
											<a href="{{path("user_password",{'id': user.id})}}" type="button" class="btn btn-outline-success">mot de passe</a>
										</td>
										<td>
											<a href="{{path("user_delete",{'id': user.id})}}" type="button" class="btn btn-outline-success">Supprimer</a>
										</td>
										<td>
											<a href="{{path("user_edit",{'id': user.id})}}" type="button" class="btn btn-outline-success">Modifier</a>
										</td>
									{% endif %}
									</tr>
								</tbody>
							{% endif %}
						{% endfor %}
					{% endfor %}
				</table>
			</ul>
		{% endfor %}
	</div>
{% endblock %}
